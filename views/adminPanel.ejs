<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Admin Panel - Send Coins</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f8ff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background-color: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); width: 400px; }
        h2 { color: #8A2BE2; border-bottom: 3px solid #8A2BE2; padding-bottom: 10px; margin-top: 0; text-align: center; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .btn-submit { background-color: #8A2BE2; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; transition: background-color 0.3s; }
        .btn-submit:hover { background-color: #6A1B9A; }
        .status-message { margin-top: 20px; padding: 15px; border-radius: 5px; font-weight: bold; }
        .success { background-color: #e6ffe6; color: #4CAF50; border: 1px solid #4CAF50; }
        .error { background-color: #ffe6e6; color: #f44336; border: 1px solid #f44336; }
        .owner-info { text-align: center; margin-bottom: 25px; padding: 10px; background-color: #fff0f5; border-radius: 5px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üëë Owner Coin Send Panel</h2>
        
        <div class="owner-info">
            ‡∂î‡∂∂ ‡∂Ω‡∑ú‡∂ú‡∑ä ‡∑Ä‡∑ì ‡∂á‡∂≠‡∑ä‡∂≠‡∑ö: <strong><%= user.email %></strong>
        </div>

        <div id="statusMessage" class="status-message" style="display: none;"></div>

        <form id="sendCoinsForm">
            <div class="form-group">
                <label for="receiverEmail">‡∂Ω‡∂∂‡∂±‡∑ä‡∂±‡∑è‡∂ú‡∑ö Email:</label>
                <input type="email" id="receiverEmail" name="receiverEmail" placeholder="user@example.com" required>
            </div>
            <div class="form-group">
                <label for="amount">‡∂∫‡∑Ä‡∂± Coins ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫:</label>
                <input type="number" id="amount" name="amount" placeholder="Coins ‡∂ú‡∂´‡∂±" min="1" required>
            </div>
            
            <input type="hidden" id="apiKey" value="<%= user.apiKey %>">
            
            <button type="submit" class="btn-submit">Coins ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±</button>
        </form>

    </div>

    <script>
        document.getElementById('sendCoinsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const receiverEmail = document.getElementById('receiverEmail').value;
            const amount = parseInt(document.getElementById('amount').value);
            const apiKey = document.getElementById('apiKey').value;
            const statusMessage = document.getElementById('statusMessage');

            statusMessage.style.display = 'none';
            statusMessage.className = 'status-message';
            
            if (amount <= 0 || !Number.isInteger(amount)) {
                statusMessage.textContent = 'Error: Amount must be a positive whole number.';
                statusMessage.classList.add('error');
                statusMessage.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('/api/admin/sendcoins', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Owner ‡∂ú‡∑ö API Key ‡∂ë‡∂ö Authorization Header ‡∂ë‡∂ö‡∂ß ‡∂∫‡∑Ä‡∂∫‡∑í
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({ receiverEmail, amount })
                });

                const data = await response.json();

                if (response.ok) {
                    statusMessage.textContent = `SUCCESS: ${data.message} | ‡∂±‡∑Ä ‡∑Å‡∑ö‡∑Ç‡∂∫: ${data.receiverNewBalance} ü™ô`;
                    statusMessage.classList.add('success');
                    // Form ‡∂ë‡∂ö ‡∑Ñ‡∑í‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                    document.getElementById('receiverEmail').value = '';
                    document.getElementById('amount').value = '';
                } else {
                    // API Call ‡∂ë‡∂ö ‡∂Ö‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö ‡∑Ä‡∑ñ ‡∑Ä‡∑í‡∂ß (400, 403, 404, 500)
                    statusMessage.textContent = `ERROR: ${data.message || 'Coin sending failed. Check console for details.'}`;
                    statusMessage.classList.add('error');
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                statusMessage.textContent = 'FATAL ERROR: Could not connect to the server.';
                statusMessage.classList.add('error');
            }
            
            statusMessage.style.display = 'block';
        });
    </script>

</body>
</html>
